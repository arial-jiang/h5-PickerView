"use strict";var PickerView=function(t){this.pickerOpts=t,this.prefix="_picker-"+(new Date).getTime(),this.itemHeight=30,this.pos={startY:0,moveY:0,endY:0,currY:0,itemStartY:0,top:0,bottom:0},this.createPickerDom(this.pickerOpts),this._pMaks=document.querySelector("."+this.prefix),this.cols=document.querySelectorAll("."+this.prefix+" ._picker-col"),this.col_list=document.querySelectorAll("."+this.prefix+" ._picker-data-list"),this.btnCancel=document.querySelector("."+this.prefix+" ._picker-btn-cancel"),this.btnConfirm=document.querySelector("."+this.prefix+" ._picker-btn-confirm"),this.selector=document.getElementById(this.pickerOpts.selector),this.bind()};PickerView.prototype={bind:function(){var t=this;this.btnCancel.addEventListener("touchend",function(){"function"==typeof t.pickerOpts.onCancel&&t.pickerOpts.onCancel(),t._pMaks.className="_picker-mask hide"},!1),this.btnConfirm.addEventListener("touchend",function(){if("function"==typeof t.pickerOpts.onConfirm){for(var e=[],c=0;c<t.pickerOpts.cols.length;c++)t.pickerOpts.cols[c].currVal?e.push(t.pickerOpts.cols[c].currVal):e.push(t.pickerOpts.cols[c].values[0]);t.pickerOpts.onConfirm(e)}t._pMaks.className="_picker-mask hide"},!1),this.selector.addEventListener("touchend",function(){t._pMaks.className="_picker-mask "+t.prefix},!1);for(var e=0;e<this.cols.length;e++)this.cols[e].addEventListener("touchstart",t.touchEventCallBack(e,"touchstart",t.pos),!1),this.cols[e].addEventListener("touchmove",t.touchEventCallBack(e,"touchmove",t.pos),!1),this.cols[e].addEventListener("touchend",t.touchEventCallBack(e,"touchend",t.pos),!1)},touchEventCallBack:function(t,e,c){var r=this;return function(s){switch(s.preventDefault(),e){case"touchstart":c.startY=s.touches[0].clientY,c.currY=c.itemStartY=(3-r.pickerOpts.cols[t].currIndex)*r.itemHeight,c.top=3*r.itemHeight,c.bottom=(3-(r.pickerOpts.cols[t].values.length-1))*r.itemHeight;break;case"touchmove":c.moveY=s.changedTouches[0].clientY,c.currY=c.itemStartY+(c.moveY-c.startY),r.col_list[t].setAttribute("style","-webkit-transform:translateY("+c.currY+"px);transform:translateY("+c.currY+"px)");break;case"touchend":c.endY=s.changedTouches[0].clientY;var i=Math.round((c.startY-c.endY)/r.itemHeight)+r.pickerOpts.cols[t].currIndex,n=r.pickerOpts.cols[t].values.length;i<0?i=0:i>=n&&(i=n-1),r.pickerOpts.cols[t].currIndex=i,r.pickerOpts.cols[t].currVal=r.pickerOpts.cols[t].values[i],r.col_list[t].setAttribute("style","-webkit-transform:translateY("+(3-i)*r.itemHeight+"px);transform:translateY("+(3-i)*r.itemHeight+"px);"),"function"==typeof r.pickerOpts.onOptionSelected&&r.pickerOpts.onOptionSelected(t,r.pickerOpts.cols[t].currIndex,r.pickerOpts.cols[t].currVal)}}},createPickerDom:function(t){for(var e="",c=0;c<t.cols.length;c++){if(t.cols[c].currVal){var r=t.cols[c].values.indexOf(t.cols[c].currVal);r===-1?(t.cols[c].currIndex=0,t.cols[c].currVal=t.cols[c].values[0]):t.cols[c].currIndex=r}else t.cols[c].currIndex=0,t.cols[c].currVal=t.cols[c].values[0];e+='<div class="_picker-col">',e+=this.setOptions(t.cols[c]),e+="</div>"}var s='<div class="_picker-mask hide '+this.prefix+'"><div class="_picker-wrapper"><div class="_picker-head"><h3 class="_picker-title">'+t.title+'</h3><a class="_picker-btn-cancel" href="javascript:;">取消</a><a class="_picker-btn-confirm" href="javascript:;">确定</a></div><div class="_picker-content">'+e+"</div></div></div>",i=document.createElement("div");i.innerHTML=s,document.body.appendChild(i)},setOptions:function(t){if(t.currVal){var e=t.values.indexOf(t.currVal);e===-1?(t.currVal=t.values[0],t.currIndex=0):t.currIndex=e}else t.currVal=t.values[0],t.currIndex=0;for(var c='<ul class="_picker-data-list" style="-webkit-transform:translateY('+(3-t.currIndex)*this.itemHeight+"px);transform:translateY("+(3-t.currIndex)*this.itemHeight+'px)">',r=0;r<t.values.length;r++)c+="<li>"+t.values[r]+"</li>";return c+"</ul>"},updateCol:function(t,e){this.cols[t].innerHTML=this.setOptions(e),this.pickerOpts.cols[t]=e,this.col_list=document.querySelectorAll("."+this.prefix+" ._picker-data-list")}};